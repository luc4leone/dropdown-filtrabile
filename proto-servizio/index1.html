<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dropdown Filtrabile</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #ffffff 0%, #eeeeee 100%);
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: flex-start;
      }

      .container {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        max-width: 400px;
        width: 100%;
      }

      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
        font-size: 24px;
      }

      .dropdown-container {
        position: relative;
        margin-bottom: 20px;
      }

      .dropdown-input {
        width: 100%;
        padding: 12px 40px 12px 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        background: white;
        outline: none;
        transition: all 0.3s ease;
        box-sizing: border-box;
        cursor: pointer;
      }

      .dropdown-input:focus {
        border-color: #888;
        box-shadow: 0 0 0 3px rgba(136, 136, 136, 0.1);
      }

      .dropdown-arrow {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-left: 6px solid transparent;
        border-right: 6px solid transparent;
        border-top: 8px solid #666;
        transition: transform 0.3s ease;
        pointer-events: none;
      }

      .dropdown-arrow.rotated {
        transform: translateY(-50%) rotate(180deg);
      }

      .dropdown-clear {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        background-color: #ccc;
        border-radius: 50%;
        display: none;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.2s ease;
        font-size: 12px;
        font-weight: bold;
        color: white;
      }

      .dropdown-clear:hover {
        background-color: #999;
      }

      .dropdown-clear.show {
        display: flex;
      }

      .dropdown-list {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 2px solid #e0e0e0;
        border-top: none;
        border-radius: 0 0 8px 8px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        opacity: 0;
        transform: translateY(-10px);
        visibility: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .dropdown-list.show {
        opacity: 1;
        transform: translateY(0);
        visibility: visible;
      }

      .dropdown-item {
        padding: 12px 15px;
        cursor: pointer;
        border-bottom: 1px solid #f0f0f0;
        transition: background-color 0.2s ease;
        display: flex;
        align-items: center;
      }

      .dropdown-item:hover {
        background-color: #f0f0f0;
      }

      .dropdown-item.selected {
        background-color: #888;
        color: black;
      }

      .dropdown-item:last-child {
        border-bottom: none;
      }

      .no-results {
        padding: 15px;
        text-align: center;
        color: #999;
        font-style: italic;
      }

      /* Scrollbar personalizzata */
      .dropdown-list::-webkit-scrollbar {
        width: 8px;
      }

      .dropdown-list::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }

      .dropdown-list::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 4px;
      }

      .dropdown-list::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
      }

      /* Evidenziazione del testo cercato */
      .highlight {
        background-color: yellow;
        padding: 1px 2px;
        border-radius: 2px;
        font-weight: normal;
      }

      /* Responsive */
      @media (max-width: 480px) {
        .container {
          margin: 10px;
          padding: 20px;
        }

        h1 {
          font-size: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Dropdown Filtrabile</h1>

      <div class="dropdown-container">
        <input
          type="text"
          class="dropdown-input"
          id="dropdownInput"
          placeholder="Seleziona un progetto o creane uno nuovo..."
          autocomplete="off"
        />
        <div class="dropdown-arrow" id="dropdownArrow"></div>
        <div class="dropdown-clear" id="dropdownClear">×</div>
        <div class="dropdown-list" id="dropdownList"></div>
      </div>
    </div>

    <script>
      class FilterableDropdown {
        constructor(inputId, options = []) {
          this.input = document.getElementById(inputId);
          this.arrow = document.getElementById("dropdownArrow");
          this.clear = document.getElementById("dropdownClear");
          this.list = document.getElementById("dropdownList");

          this.originalOptions = options;
          this.filteredOptions = [...options];
          this.selectedValue = null;
          this.isOpen = false;
          this.selectedIndex = -1;

          this.init();
        }

        init() {
          this.renderList();
          this.bindEvents();
          this.updateClearVisibility();
        }

        bindEvents() {
          // Click sull'input per aprire/chiudere
          this.input.addEventListener("click", () => {
            // Se c'è un valore selezionato, seleziona tutto il testo
            if (this.selectedValue && this.input.value) {
              this.input.select();
            }
            this.toggle();
          });

          // Input per filtrare
          this.input.addEventListener("input", (e) => {
            this.filterOptions(e.target.value);
            if (!this.isOpen) {
              this.open();
            }
            this.selectedIndex = -1;
          });

          // Navigazione con tastiera
          this.input.addEventListener("keydown", (e) => {
            this.handleKeyboard(e);
          });

          // Click sulla X per reset
          this.clear.addEventListener("click", (e) => {
            e.stopPropagation();
            this.resetSelection();
          });

          // Chiudi quando si clicca fuori
          document.addEventListener("click", (e) => {
            if (
              !this.input.contains(e.target) &&
              !this.list.contains(e.target) &&
              !this.clear.contains(e.target)
            ) {
              this.close();
            }
          });
        }

        filterOptions(query) {
          const searchTerm = query.toLowerCase();
          this.filteredOptions = this.originalOptions.filter((option) =>
            option.toLowerCase().includes(searchTerm)
          );
          this.renderList();
        }

        // Funzione per evidenziare il testo cercato
        highlightSearchText(text, searchTerm) {
          if (!searchTerm || searchTerm.trim() === "") {
            return text;
          }

          const regex = new RegExp(
            `(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")})`,
            "gi"
          );
          return text.replace(regex, '<span class="highlight">$1</span>');
        }

        renderList() {
          this.list.innerHTML = "";

          // Se c'è del testo nell'input, mostra sempre l'opzione per creare un nuovo progetto in cima
          if (this.input.value.trim()) {
            const saveNewProject = document.createElement("div");
            saveNewProject.className = "dropdown-item save-new-project";
            saveNewProject.innerHTML = `Crea nuovo progetto "${this.input.value}"`;
            saveNewProject.style.color = "#007bff";
            saveNewProject.style.cursor = "pointer";
            saveNewProject.style.fontWeight = "bold";
            saveNewProject.style.borderBottom = "2px solid #e0e0e0";

            saveNewProject.addEventListener("click", () => {
              this.saveNewProject(this.input.value.trim());
            });

            this.list.appendChild(saveNewProject);
          }

          // Se non ci sono risultati filtrati, mostra solo il messaggio di nessun risultato
          if (this.filteredOptions.length === 0) {
            if (!this.input.value.trim()) {
              const noResults = document.createElement("div");
              noResults.className = "no-results";
              noResults.textContent = "Nessun risultato trovato";
              this.list.appendChild(noResults);
            }
            return;
          }

          // Mostra i risultati filtrati
          this.filteredOptions.forEach((option, index) => {
            const item = document.createElement("div");
            item.className = "dropdown-item";

            // Evidenzia il testo cercato solo se c'è una ricerca attiva
            const searchTerm = this.input.value.trim();
            if (searchTerm && searchTerm !== option) {
              item.innerHTML = this.highlightSearchText(option, searchTerm);
            } else {
              item.textContent = option;
            }

            item.dataset.index = index;

            if (option === this.selectedValue) {
              item.classList.add("selected");
            }

            item.addEventListener("click", () => {
              this.selectOption(option);
            });

            this.list.appendChild(item);
          });
        }

        selectOption(option) {
          this.selectedValue = option;
          this.input.value = option;
          // Resetta il filtro per mostrare tutte le opzioni alla prossima apertura
          this.filteredOptions = [...this.originalOptions];
          this.close();
          this.renderList(); // Ricarica per mostrare la selezione
          this.updateClearVisibility();
        }

        resetSelection() {
          this.selectedValue = null;
          this.input.value = "";
          this.filteredOptions = [...this.originalOptions];
          this.close();
          this.renderList();
          this.updateClearVisibility();
        }

        updateClearVisibility() {
          if (this.selectedValue) {
            this.clear.classList.add("show");
            this.arrow.style.display = "none";
          } else {
            this.clear.classList.remove("show");
            this.arrow.style.display = "block";
          }
        }

        handleKeyboard(e) {
          if (!this.isOpen && (e.key === "ArrowDown" || e.key === "ArrowUp")) {
            e.preventDefault();
            this.open();
            return;
          }

          if (!this.isOpen) return;

          const hasCreateOption = this.input.value.trim() !== "";
          const totalItems =
            this.filteredOptions.length + (hasCreateOption ? 1 : 0);

          switch (e.key) {
            case "ArrowDown":
              e.preventDefault();
              this.selectedIndex = Math.min(
                this.selectedIndex + 1,
                totalItems - 1
              );
              this.highlightItem();
              break;

            case "ArrowUp":
              e.preventDefault();
              this.selectedIndex = Math.max(this.selectedIndex - 1, 0);
              this.highlightItem();
              break;

            case "Enter":
              e.preventDefault();
              if (this.selectedIndex >= 0) {
                // Se ha selezionato l'opzione "Crea nuovo progetto" (indice 0 quando c'è del testo)
                if (hasCreateOption && this.selectedIndex === 0) {
                  this.saveNewProject(this.input.value.trim());
                } else {
                  // Calcola l'indice corretto per le opzioni filtrate
                  const optionIndex = hasCreateOption
                    ? this.selectedIndex - 1
                    : this.selectedIndex;
                  if (this.filteredOptions[optionIndex]) {
                    this.selectOption(this.filteredOptions[optionIndex]);
                  }
                }
              }
              break;

            case "Escape":
              this.close();
              break;
          }
        }

        highlightItem() {
          const items = this.list.querySelectorAll(".dropdown-item");
          items.forEach((item, index) => {
            item.style.backgroundColor =
              index === this.selectedIndex ? "#f0f0f0" : "";
          });

          // Scroll nell'elemento evidenziato
          if (items[this.selectedIndex]) {
            items[this.selectedIndex].scrollIntoView({ block: "nearest" });
          }
        }

        open() {
          this.isOpen = true;
          // Resetta il filtro per mostrare tutte le opzioni
          this.filteredOptions = [...this.originalOptions];
          this.renderList();

          // Se c'è un valore selezionato, posiziona la tendina su quello
          if (this.selectedValue) {
            this.selectedIndex = this.filteredOptions.indexOf(
              this.selectedValue
            );
            this.highlightItem();
          } else {
            this.selectedIndex = -1;
          }

          this.list.classList.add("show");
          this.arrow.classList.add("rotated");
          this.input.style.borderRadius = "8px 8px 0 0";
        }

        close() {
          this.isOpen = false;
          this.list.classList.remove("show");
          this.arrow.classList.remove("rotated");
          this.input.style.borderRadius = "8px";
          this.selectedIndex = -1;
        }

        toggle() {
          if (this.isOpen) {
            this.close();
          } else {
            this.open();
          }
        }

        // Metodo per salvare un nuovo progetto
        saveNewProject(projectName) {
          if (projectName && !this.originalOptions.includes(projectName)) {
            // Trova la posizione corretta per inserire il nuovo elemento in ordine alfabetico
            let insertIndex = 0;
            for (let i = 0; i < this.originalOptions.length; i++) {
              if (
                this.originalOptions[i].toLowerCase() >
                projectName.toLowerCase()
              ) {
                insertIndex = i;
                break;
              }
              insertIndex = i + 1;
            }

            // Inserisci il nuovo elemento nella posizione corretta
            this.originalOptions.splice(insertIndex, 0, projectName);
            this.filteredOptions = [...this.originalOptions];

            // Seleziona automaticamente il nuovo progetto
            this.selectOption(projectName);
          }
        }

        // Metodi pubblici per gestire le opzioni
        addOption(option) {
          if (!this.originalOptions.includes(option)) {
            this.originalOptions.push(option);
            this.filteredOptions = [...this.originalOptions];
            this.renderList();
          }
        }

        removeOption(option) {
          this.originalOptions = this.originalOptions.filter(
            (opt) => opt !== option
          );
          this.filteredOptions = [...this.originalOptions];
          this.renderList();
        }

        setOptions(options) {
          this.originalOptions = options;
          this.filteredOptions = [...options];
          this.renderList();
        }
      }

      // Dati di esempio - qui puoi inserire i tuoi 80 elementi
      const sampleOptions = [
        "Adobe Photoshop",
        "Adobe Illustrator",
        "Adobe InDesign",
        "Adobe Premiere Pro",
        "Adobe After Effects",
        "Adobe XD",
        "Adobe Lightroom",
        "Adobe Acrobat",
        "Microsoft Word",
        "Microsoft Excel",
        "Microsoft PowerPoint",
        "Microsoft Outlook",
        "Microsoft Teams",
        "Microsoft OneNote",
        "Microsoft Access",
        "Microsoft Publisher",
        "Google Chrome",
        "Google Drive",
        "Google Docs",
        "Google Sheets",
        "Google Slides",
        "Google Photos",
        "Google Maps",
        "Google Calendar",
        "Mozilla Firefox",
        "Mozilla Thunderbird",
        "Safari",
        "Opera",
        "Visual Studio Code",
        "Visual Studio",
        "IntelliJ IDEA",
        "Eclipse",
        "Sublime Text",
        "Atom",
        "Notepad++",
        "Brackets",
        "Figma",
        "Sketch",
        "Canva",
        "GIMP",
        "Blender",
        "AutoCAD",
        "SketchUp",
        "Solidworks",
        "Zoom",
        "Skype",
        "Discord",
        "Slack",
        "Trello",
        "Asana",
        "Monday.com",
        "Jira",
        "Spotify",
        "iTunes",
        "VLC Media Player",
        "Windows Media Player",
        "WinRAR",
        "7-Zip",
        "CCleaner",
        "Malwarebytes",
        "Antivirus Avast",
        "Antivirus Norton",
        "Antivirus McAfee",
        "Antivirus Kaspersky",
        "Steam",
        "Epic Games",
        "Origin",
        "Uplay",
        "OBS Studio",
        "Streamlabs",
        "Audacity",
        "FL Studio",
        "Unity",
        "Unreal Engine",
        "GameMaker Studio",
        "Construct 3",
        "Node.js",
        "Python",
        "Java",
        "C++",
        "React",
        "Angular",
        "Vue.js",
        "jQuery",
        "WordPress",
        "Drupal",
        "Joomla",
        "Magento",
        "Shopify",
        "WooCommerce",
        "PrestaShop",
        "OpenCart",
      ];

      // Ordina le opzioni in ordine alfabetico prima di inizializzare
      sampleOptions.sort((a, b) =>
        a.toLowerCase().localeCompare(b.toLowerCase())
      );

      // Inizializza la dropdown
      const dropdown = new FilterableDropdown("dropdownInput", sampleOptions);

      // Esempio di come aggiungere opzioni dinamicamente
      // dropdown.addOption('Nuova Opzione');

      // Esempio di come cambiare tutte le opzioni
      // dropdown.setOptions(['Opzione 1', 'Opzione 2', 'Opzione 3']);
    </script>
  </body>
</html>
